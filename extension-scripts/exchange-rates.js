$app.theme = "auto";

$app.strings = {
  "en": {
    "main-title": "Exchange Rates",
    "copied": "Copied",
    "name-eur": "ðŸ‡ªðŸ‡º Euro",
    "name-cny": "ðŸ‡¨ðŸ‡³ Chinese Yuan",
    "name-hkd": "ðŸ‡­ðŸ‡° Hong Kong Dollar",
    "name-usd": "ðŸ‡ºðŸ‡¸ US Dollar",
    "name-gbp": "ðŸ‡¬ðŸ‡§ British Pound",
    "name-jpy": "ðŸ‡¯ðŸ‡µ Japanese Yen",
    "name-inr": "ðŸ‡®ðŸ‡³ Indian Rupee",
    "name-aud": "ðŸ‡¦ðŸ‡º Australian Dollar",
    "name-cad": "ðŸ‡¨ðŸ‡¦ Canadian Dollar",
    "name-sgd": "ðŸ‡¸ðŸ‡¬ Singapore Dollar",
    "name-chf": "ðŸ‡¨ðŸ‡­ Swiss Franc",
    "name-myr": "ðŸ‡²ðŸ‡¾ Malaysian Ringgit",
    "name-thb": "ðŸ‡¹ðŸ‡­ Thai Baht",
    "name-krw": "ðŸ‡°ðŸ‡· South Korean Won",
    "name-bgn": "ðŸ‡§ðŸ‡¬ Bulgarian Lev",
    "name-brl": "ðŸ‡§ðŸ‡· Brazilian Real",
    "name-czk": "ðŸ‡¨ðŸ‡¿ Czech Koruna",
    "name-dkk": "ðŸ‡©ðŸ‡° Danish Krone",
    "name-hrk": "ðŸ‡­ðŸ‡· Croatian Kuna",
    "name-huf": "ðŸ‡­ðŸ‡º Hungarian Forint",
    "name-idr": "ðŸ‡®ðŸ‡© Indonesian Rupiah",
    "name-ils": "ðŸ‡®ðŸ‡± Israeli Shekel",
    "name-mxn": "ðŸ‡²ðŸ‡½ Mexican Peso",
    "name-nok": "ðŸ‡³ðŸ‡´ Norwegian Krone",
    "name-nzd": "ðŸ‡³ðŸ‡¿ New Zealand Dollar",
    "name-php": "ðŸ‡µðŸ‡­ Philippine Peso",
    "name-pln": "ðŸ‡µðŸ‡± Polish Zloty",
    "name-ron": "ðŸ‡·ðŸ‡´ Romanian Leu",
    "name-rub": "ðŸ‡·ðŸ‡º Russian Ruble",
    "name-sek": "ðŸ‡¸ðŸ‡ª Swedish Krona",
    "name-try": "ðŸ‡¹ðŸ‡· Turkish Lira",
    "name-zar": "ðŸ‡¿ðŸ‡¦ South African Rand"
  },
  "zh-Hans": {
    "main-title": "æ±‡çŽ‡æŸ¥è¯¢",
    "copied": "å·²å¤åˆ¶",
    "name-eur": "ðŸ‡ªðŸ‡º æ¬§å…ƒ",
    "name-cny": "ðŸ‡¨ðŸ‡³ äººæ°‘å¸",
    "name-hkd": "ðŸ‡­ðŸ‡° æ¸¯å¸",
    "name-usd": "ðŸ‡ºðŸ‡¸ ç¾Žå…ƒ",
    "name-gbp": "ðŸ‡¬ðŸ‡§ è‹±é•‘",
    "name-jpy": "ðŸ‡¯ðŸ‡µ æ—¥å…ƒ",
    "name-inr": "ðŸ‡®ðŸ‡³ å°åº¦å¢æ¯”",
    "name-aud": "ðŸ‡¦ðŸ‡º æ¾³å…ƒ",
    "name-cad": "ðŸ‡¨ðŸ‡¦ åŠ æ‹¿å¤§å…ƒ",
    "name-sgd": "ðŸ‡¸ðŸ‡¬ æ–°åŠ å¡å…ƒ",
    "name-chf": "ðŸ‡¨ðŸ‡­ ç‘žå£«æ³•éƒŽ",
    "name-myr": "ðŸ‡²ðŸ‡¾ é©¬æ¥è¥¿äºšæž—å‰ç‰¹",
    "name-thb": "ðŸ‡¹ðŸ‡­ æ³°é“¢",
    "name-krw": "ðŸ‡°ðŸ‡· éŸ©å…ƒ",
    "name-bgn": "ðŸ‡§ðŸ‡¬ ä¿åŠ åˆ©äºšåˆ—å¼—",
    "name-brl": "ðŸ‡§ðŸ‡· å·´è¥¿é›·äºšå°”",
    "name-czk": "ðŸ‡¨ðŸ‡¿ æ·å…‹å…‹æœ—",
    "name-dkk": "ðŸ‡©ðŸ‡° ä¸¹éº¦å…‹éƒŽ",
    "name-hrk": "ðŸ‡­ðŸ‡· å…‹ç½—åœ°äºšåº“é‚£",
    "name-huf": "ðŸ‡­ðŸ‡º åŒˆç‰™åˆ©ç¦æž—",
    "name-idr": "ðŸ‡®ðŸ‡© å°å°¼å¢æ¯”",
    "name-ils": "ðŸ‡®ðŸ‡± ä»¥è‰²åˆ—é•‘",
    "name-mxn": "ðŸ‡²ðŸ‡½ å¢¨è¥¿å“¥æ¯”ç´¢",
    "name-nok": "ðŸ‡³ðŸ‡´ æŒªå¨å…‹éƒŽ",
    "name-nzd": "ðŸ‡³ðŸ‡¿ æ–°è¥¿å…°å…ƒ",
    "name-php": "ðŸ‡µðŸ‡­ è²å¾‹å®¾æ¯”ç´¢",
    "name-pln": "ðŸ‡µðŸ‡± æ³¢å…°å…¹ç½—æ",
    "name-ron": "ðŸ‡·ðŸ‡´ ç½—é©¬å°¼äºšåˆ—ä¼Š",
    "name-rub": "ðŸ‡·ðŸ‡º ä¿„ç½—æ–¯å¢å¸ƒ",
    "name-sek": "ðŸ‡¸ðŸ‡ª ç‘žå…¸å…‹éƒŽ",
    "name-try": "ðŸ‡¹ðŸ‡· åœŸè€³å…¶é‡Œæ‹‰",
    "name-zar": "ðŸ‡¿ðŸ‡¦ å—éžå…°ç‰¹"
  },
  "zh-Hant": {
    "main-title": "åŒ¯çŽ‡æŸ¥è©¢",
    "copied": "å·²å¾©åˆ¶",
    "name-eur": "ðŸ‡ªðŸ‡º æ­å…ƒ",
    "name-cny": "ðŸ‡¨ðŸ‡³ äººæ°‘å¹£",
Â Â Â Â "name-hkd": "ðŸ‡­ðŸ‡° æ¸¯å¹£",
Â Â Â Â "name-usd": "ðŸ‡ºðŸ‡¸ ç¾Žå…ƒ",
Â Â Â Â "name-gbp": "ðŸ‡¬ðŸ‡§ è‹±éŽŠ",
Â Â Â Â "name-jpy": "ðŸ‡¯ðŸ‡µ æ—¥å…ƒ",
Â Â Â Â "name-inr": "ðŸ‡®ðŸ‡³ å°åº¦ç›§æ¯”",
Â Â Â Â "name-aud": "ðŸ‡¦ðŸ‡º æ¾³å…ƒ",
Â Â Â Â "name-cad": "ðŸ‡¨ðŸ‡¦ åŠ æ‹¿å¤§å…ƒ",
Â Â Â Â "name-sgd": "ðŸ‡¸ðŸ‡¬ æ–°åŠ å¡å…ƒ",
Â Â Â Â "name-chf": "ðŸ‡¨ðŸ‡­ ç‘žå£«æ³•éƒŽ",
Â Â Â Â "name-myr": "ðŸ‡²ðŸ‡¾ é¦¬ä¾†è¥¿äºžæž—å‰ç‰¹",
Â Â Â Â "name-thb": "ðŸ‡¹ðŸ‡­ æ³°éŠ–",
Â Â Â Â "name-krw": "ðŸ‡°ðŸ‡· éŸ“å…ƒ",
Â Â Â Â "name-bgn": "ðŸ‡§ðŸ‡¬ ä¿åŠ åˆ©äºžåˆ—å¼—",
Â Â Â Â "name-brl": "ðŸ‡§ðŸ‡· å·´è¥¿é›·äºžçˆ¾",
Â Â Â Â "name-czk": "ðŸ‡¨ðŸ‡¿ æ·å…‹å…‹æœ—",
Â Â Â Â "name-dkk": "ðŸ‡©ðŸ‡° ä¸¹éº¥å…‹éƒŽ",
Â Â Â Â "name-hrk": "ðŸ‡­ðŸ‡· å…‹ç¾…åœ°äºžåº«é‚£",
Â Â Â Â "name-huf": "ðŸ‡­ðŸ‡º åŒˆç‰™åˆ©ç¦æž—",
Â Â Â Â "name-idr": "ðŸ‡®ðŸ‡© å°å°¼ç›§æ¯”",
Â Â Â Â "name-ils": "ðŸ‡®ðŸ‡± ä»¥è‰²åˆ—éŽŠ",
Â Â Â Â "name-mxn": "ðŸ‡²ðŸ‡½ å¢¨è¥¿å“¥æ¯”ç´¢",
Â Â Â Â "name-nok": "ðŸ‡³ðŸ‡´ æŒªå¨å…‹éƒŽ",
Â Â Â Â "name-nzd": "ðŸ‡³ðŸ‡¿ æ–°è¥¿è˜­å…ƒ",
Â Â Â Â "name-php": "ðŸ‡µðŸ‡­ è²å¾‹è³“æ¯”ç´¢",
Â Â Â Â "name-pln": "ðŸ‡µðŸ‡± æ³¢è˜­èŒ²ç¾…æ",
Â Â Â Â "name-ron": "ðŸ‡·ðŸ‡´ ç¾…é¦¬å°¼äºžåˆ—ä¼Š",
Â Â Â Â "name-rub": "ðŸ‡·ðŸ‡º ä¿„ç¾…æ–¯ç›§å¸ƒ",
Â Â Â Â "name-sek": "ðŸ‡¸ðŸ‡ª ç‘žå…¸å…‹éƒŽ",
Â Â Â Â "name-try": "ðŸ‡¹ðŸ‡· åœŸè€³å…¶é‡Œæ‹‰",
Â Â Â Â "name-zar": "ðŸ‡¿ðŸ‡¦ å—éžè˜­ç‰¹"
  }
}

const symbols = ["EUR", "CNY", "HKD", "USD", "GBP", "JPY", "INR", "AUD", "CAD", "SGD", "CHF", "MYR", "THB", "KRW", "BGN", "BRL", "CZK", "DKK", "HRK", "HUF", "IDR", "ILS", "MXN", "NOK", "NZD", "PHP", "PLN", "RON", "RUB", "SEK", "TRY", "ZAR"];

const names = symbols.map(item => $l10n(`name-${item.toLowerCase()}`));

let rates = {};
let selectedIndex = $cache.get("selected-index") || 0;

$ui.render({
  props: { title: $l10n("main-title") },
  views: [
    {
      type: "input",
      props: {
        type: $kbType.decimal,
        text: "1"
      },
      layout({left, height, width}, view) {
        left.top.inset(10);
        height.equalTo(32);
        width
          .equalTo(view.super)
          .multipliedBy(0.5)
          .offset(-15);
      },
      events: {
        changed(sender) {
          calculate();
        }
      }
    },
    {
      type: "button",
      props: { title: names[selectedIndex] },
      layout({left, top, right}) {
        const input = $("input");
        left.equalTo(input.right).offset(10);
        top.height.equalTo(input);
        right.inset(10);
      },
      events: {
        tapped(sender) {
          $ui.menu({
            items: names,
            handler(title, idx) {
              selectedIndex = idx;
              sender.title = names[idx];
              calculate();
              $cache.set("selected-index", idx);
            }
          });
        }
      }
    },
    {
      type: "list",
      props: {
        template: [
          {
            type: "label",
            props: {
              id: "name-label"
            },
            layout({left, centerY}, view) {
              left.equalTo(15);
              centerY.equalTo(view.super);
            }
          },
          {
            type: "label",
            props: {
              id: "value-label",
              align: $align.center
            },
            layout({centerY, right}, view) {
              centerY.equalTo(view.super);
              right.inset(15);
            }
          }
        ],
        data: names.map(item => ({
          "name-label": { text: item }
        }))
      },
      layout({top, left}) {
        top.equalTo($("input").bottom).offset(10);
        left.bottom.right.equalTo(0);
      },
      events: {
        pulled() {
          fetch(true);
        },
        didSelect(sender, {row}) {
          const base = rates[symbols[selectedIndex]] || 1.0;
          const number = Number($("input").text);
          $clipboard.text = (
            (number * (rates[symbols[row]] || 1.0)) /
            base
          ).toFixed(4);
          $ui.toast($l10n("copied"));
        }
      }
    }
  ]
});

function calculate() {
  const base = rates[symbols[selectedIndex]] || 1.0;
  const number = Number($("input").text);
  $("list").data = symbols.map((symbol, idx) => ({
    "name-label": { text: names[idx] },

    "value-label": {
      text:
        `${((number * (rates[symbol] || 1.0)) / base).toFixed(4)} ${symbol}`
    }
  }));
}

function fetch(pulled) {
  $ui.loading(!pulled);
  $http.get({
    url: "https://api.exchangeratesapi.io/latest",
    handler({data}) {
      $ui.loading(false);
      $("list").endRefreshing();
      rates = data.rates;
      calculate();
    }
  });
}

fetch(false);