$app.open()
$app.strings = {
  "en": {
    "main-title": "Exchange Rates",
    "copied": "Copied",
    "name-eur": "ğŸ‡ªğŸ‡º Euro",
    "name-cny": "ğŸ‡¨ğŸ‡³ Chinese Yuan",
    "name-hkd": "ğŸ‡­ğŸ‡° Hong Kong Dollar",
    "name-usd": "ğŸ‡ºğŸ‡¸ US Dollar",
    "name-gbp": "ğŸ‡¬ğŸ‡§ British Pound",
    "name-jpy": "ğŸ‡¯ğŸ‡µ Japanese Yen",
    "name-inr": "ğŸ‡®ğŸ‡³ Indian Rupee",
    "name-aud": "ğŸ‡¦ğŸ‡º Australian Dollar",
    "name-cad": "ğŸ‡¨ğŸ‡¦ Canadian Dollar",
    "name-sgd": "ğŸ‡¸ğŸ‡¬ Singapore Dollar",
    "name-chf": "ğŸ‡¨ğŸ‡­ Swiss Franc",
    "name-myr": "ğŸ‡²ğŸ‡¾ Malaysian Ringgit",
    "name-thb": "ğŸ‡¹ğŸ‡­ Thai Baht",
    "name-krw": "ğŸ‡°ğŸ‡· South Korean Won",
    "name-bgn": "ğŸ‡§ğŸ‡¬ Bulgarian Lev",
    "name-brl": "ğŸ‡§ğŸ‡· Brazilian Real",
    "name-czk": "ğŸ‡¨ğŸ‡¿ Czech Koruna",
    "name-dkk": "ğŸ‡©ğŸ‡° Danish Krone",
    "name-hrk": "ğŸ‡­ğŸ‡· Croatian Kuna",
    "name-huf": "ğŸ‡­ğŸ‡º Hungarian Forint",
    "name-idr": "ğŸ‡®ğŸ‡© Indonesian Rupiah",
    "name-ils": "ğŸ‡®ğŸ‡± Israeli Shekel",
    "name-mxn": "ğŸ‡²ğŸ‡½ Mexican Peso",
    "name-nok": "ğŸ‡³ğŸ‡´ Norwegian Krone",
    "name-nzd": "ğŸ‡³ğŸ‡¿ New Zealand Dollar",
    "name-php": "ğŸ‡µğŸ‡­ Philippine Peso",
    "name-pln": "ğŸ‡µğŸ‡± Polish Zloty",
    "name-ron": "ğŸ‡·ğŸ‡´ Romanian Leu",
    "name-rub": "ğŸ‡·ğŸ‡º Russian Ruble",
    "name-sek": "ğŸ‡¸ğŸ‡ª Swedish Krona",
    "name-try": "ğŸ‡¹ğŸ‡· Turkish Lira",
    "name-zar": "ğŸ‡¿ğŸ‡¦ South African Rand"
  },
  "zh-Hans": {
    "main-title": "æ±‡ç‡æŸ¥è¯¢",
    "copied": "å·²å¤åˆ¶",
    "name-eur": "ğŸ‡ªğŸ‡º æ¬§å…ƒ",
    "name-cny": "ğŸ‡¨ğŸ‡³ äººæ°‘å¸",
    "name-hkd": "ğŸ‡­ğŸ‡° æ¸¯å¸",
    "name-usd": "ğŸ‡ºğŸ‡¸ ç¾å…ƒ",
    "name-gbp": "ğŸ‡¬ğŸ‡§ è‹±é•‘",
    "name-jpy": "ğŸ‡¯ğŸ‡µ æ—¥å…ƒ",
    "name-inr": "ğŸ‡®ğŸ‡³ å°åº¦å¢æ¯”",
    "name-aud": "ğŸ‡¦ğŸ‡º æ¾³å…ƒ",
    "name-cad": "ğŸ‡¨ğŸ‡¦ åŠ æ‹¿å¤§å…ƒ",
    "name-sgd": "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡å…ƒ",
    "name-chf": "ğŸ‡¨ğŸ‡­ ç‘å£«æ³•éƒ",
    "name-myr": "ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšæ—å‰ç‰¹",
    "name-thb": "ğŸ‡¹ğŸ‡­ æ³°é“¢",
    "name-krw": "ğŸ‡°ğŸ‡· éŸ©å…ƒ",
    "name-bgn": "ğŸ‡§ğŸ‡¬ ä¿åŠ åˆ©äºšåˆ—å¼—",
    "name-brl": "ğŸ‡§ğŸ‡· å·´è¥¿é›·äºšå°”",
    "name-czk": "ğŸ‡¨ğŸ‡¿ æ·å…‹å…‹æœ—",
    "name-dkk": "ğŸ‡©ğŸ‡° ä¸¹éº¦å…‹éƒ",
    "name-hrk": "ğŸ‡­ğŸ‡· å…‹ç½—åœ°äºšåº“é‚£",
    "name-huf": "ğŸ‡­ğŸ‡º åŒˆç‰™åˆ©ç¦æ—",
    "name-idr": "ğŸ‡®ğŸ‡© å°å°¼å¢æ¯”",
    "name-ils": "ğŸ‡®ğŸ‡± ä»¥è‰²åˆ—é•‘",
    "name-mxn": "ğŸ‡²ğŸ‡½ å¢¨è¥¿å“¥æ¯”ç´¢",
    "name-nok": "ğŸ‡³ğŸ‡´ æŒªå¨å…‹éƒ",
    "name-nzd": "ğŸ‡³ğŸ‡¿ æ–°è¥¿å…°å…ƒ",
    "name-php": "ğŸ‡µğŸ‡­ è²å¾‹å®¾æ¯”ç´¢",
    "name-pln": "ğŸ‡µğŸ‡± æ³¢å…°å…¹ç½—æ",
    "name-ron": "ğŸ‡·ğŸ‡´ ç½—é©¬å°¼äºšåˆ—ä¼Š",
    "name-rub": "ğŸ‡·ğŸ‡º ä¿„ç½—æ–¯å¢å¸ƒ",
    "name-sek": "ğŸ‡¸ğŸ‡ª ç‘å…¸å…‹éƒ",
    "name-try": "ğŸ‡¹ğŸ‡· åœŸè€³å…¶é‡Œæ‹‰",
    "name-zar": "ğŸ‡¿ğŸ‡¦ å—éå…°ç‰¹"
  },
  "zh-Hant": {
    "main-title": "åŒ¯ç‡æŸ¥è©¢",
    "copied": "å·²å¾©åˆ¶",
    "name-eur": "ğŸ‡ªğŸ‡º æ­å…ƒ",
    "name-cny": "ğŸ‡¨ğŸ‡³ äººæ°‘å¹£",
Â Â Â Â "name-hkd": "ğŸ‡­ğŸ‡° æ¸¯å¹£",
Â Â Â Â "name-usd": "ğŸ‡ºğŸ‡¸ ç¾å…ƒ",
Â Â Â Â "name-gbp": "ğŸ‡¬ğŸ‡§ è‹±éŠ",
Â Â Â Â "name-jpy": "ğŸ‡¯ğŸ‡µ æ—¥å…ƒ",
Â Â Â Â "name-inr": "ğŸ‡®ğŸ‡³ å°åº¦ç›§æ¯”",
Â Â Â Â "name-aud": "ğŸ‡¦ğŸ‡º æ¾³å…ƒ",
Â Â Â Â "name-cad": "ğŸ‡¨ğŸ‡¦ åŠ æ‹¿å¤§å…ƒ",
Â Â Â Â "name-sgd": "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡å…ƒ",
Â Â Â Â "name-chf": "ğŸ‡¨ğŸ‡­ ç‘å£«æ³•éƒ",
Â Â Â Â "name-myr": "ğŸ‡²ğŸ‡¾ é¦¬ä¾†è¥¿äºæ—å‰ç‰¹",
Â Â Â Â "name-thb": "ğŸ‡¹ğŸ‡­ æ³°éŠ–",
Â Â Â Â "name-krw": "ğŸ‡°ğŸ‡· éŸ“å…ƒ",
Â Â Â Â "name-bgn": "ğŸ‡§ğŸ‡¬ ä¿åŠ åˆ©äºåˆ—å¼—",
Â Â Â Â "name-brl": "ğŸ‡§ğŸ‡· å·´è¥¿é›·äºçˆ¾",
Â Â Â Â "name-czk": "ğŸ‡¨ğŸ‡¿ æ·å…‹å…‹æœ—",
Â Â Â Â "name-dkk": "ğŸ‡©ğŸ‡° ä¸¹éº¥å…‹éƒ",
Â Â Â Â "name-hrk": "ğŸ‡­ğŸ‡· å…‹ç¾…åœ°äºåº«é‚£",
Â Â Â Â "name-huf": "ğŸ‡­ğŸ‡º åŒˆç‰™åˆ©ç¦æ—",
Â Â Â Â "name-idr": "ğŸ‡®ğŸ‡© å°å°¼ç›§æ¯”",
Â Â Â Â "name-ils": "ğŸ‡®ğŸ‡± ä»¥è‰²åˆ—éŠ",
Â Â Â Â "name-mxn": "ğŸ‡²ğŸ‡½ å¢¨è¥¿å“¥æ¯”ç´¢",
Â Â Â Â "name-nok": "ğŸ‡³ğŸ‡´ æŒªå¨å…‹éƒ",
Â Â Â Â "name-nzd": "ğŸ‡³ğŸ‡¿ æ–°è¥¿è˜­å…ƒ",
Â Â Â Â "name-php": "ğŸ‡µğŸ‡­ è²å¾‹è³“æ¯”ç´¢",
Â Â Â Â "name-pln": "ğŸ‡µğŸ‡± æ³¢è˜­èŒ²ç¾…æ",
Â Â Â Â "name-ron": "ğŸ‡·ğŸ‡´ ç¾…é¦¬å°¼äºåˆ—ä¼Š",
Â Â Â Â "name-rub": "ğŸ‡·ğŸ‡º ä¿„ç¾…æ–¯ç›§å¸ƒ",
Â Â Â Â "name-sek": "ğŸ‡¸ğŸ‡ª ç‘å…¸å…‹éƒ",
Â Â Â Â "name-try": "ğŸ‡¹ğŸ‡· åœŸè€³å…¶é‡Œæ‹‰",
Â Â Â Â "name-zar": "ğŸ‡¿ğŸ‡¦ å—éè˜­ç‰¹"
  }
}

var symbols = ["EUR", "CNY", "HKD", "USD", "GBP", "JPY", "INR", "AUD", "CAD", "SGD", "CHF", "MYR", "THB", "KRW", "BGN", "BRL", "CZK", "DKK", "HRK", "HUF", "IDR", "ILS", "MXN", "NOK", "NZD", "PHP", "PLN", "RON", "RUB", "SEK", "TRY", "ZAR"]
var names = symbols.map(function(item) {
  return $l10n("name-" + item.toLowerCase())
})
var rates = {}
var selectedIndex = $cache.get("selected-index") || 0

$ui.render({
  props: { title: $l10n("main-title") },
  views: [
    {
      type: "input",
      props: {
        type: $kbType.decimal,
        text: "1"
      },
      layout: function(make, view) {
        make.left.top.inset(10)
        make.height.equalTo(32)
        make.width.equalTo(view.super).multipliedBy(0.5).offset(-15)
      },
      events: {
        changed: function(sender) { calculate() }
      }
    },
    {
      type: "button",
      props: { title: names[selectedIndex] },
      layout: function(make) {
        var input = $("input")
        make.left.equalTo(input.right).offset(10)
        make.top.height.equalTo(input)
        make.right.inset(10)
      },
      events: {
        tapped: function(sender) {
          $ui.menu({
            items: names,
            handler: function(title, idx) {
              selectedIndex = idx
              sender.title = names[idx]
              calculate()
              $cache.set("selected-index", idx)
            }
          })
        }
      }
    },
    {
      type: "list",
      props: {
        template: [
          {
            type: "label",
            props: {
              id: "name-label"
            },
            layout: function(make, view) {
              make.left.equalTo(15)
              make.centerY.equalTo(view.super)
            }
          },
          {
            type: "label",
            props: {
              id: "value-label",
              align: $align.center
            },
            layout: function(make, view) {
              make.centerY.equalTo(view.super)
              make.right.inset(15)
            }
          }
        ],
        data: names.map(function(item) { return { "name-label": { text: item } } })
      },
      layout: function(make) {
        make.top.equalTo($("input").bottom).offset(10)
        make.left.bottom.right.equalTo(0)
      },
      events: {
        pulled: function() { fetch(true) },
        didSelect: function(sender, indexPath) {
          var base = rates[symbols[selectedIndex]] || 1.0
          var number = Number($("input").text)
          $clipboard.text = (number * (rates[symbols[indexPath.row]] || 1.0) / base).toFixed(4)
          $ui.toast($l10n("copied"))
        }
      }
    }
  ]
})

function calculate() {
  var base = rates[symbols[selectedIndex]] || 1.0
  var number = Number($("input").text)
  $("list").data = symbols.map(function(symbol, idx) {
    return {
      "name-label": { text: names[idx] },
      "value-label": { text: (number * (rates[symbol] || 1.0) / base).toFixed(4) + " " + symbol }
    }
  })
}

function fetch(pulled) {
  $ui.loading(!pulled)
  $http.get({
    url: "https://exchangeratesapi.io/api/latest",
    handler: function(resp) {
      $ui.loading(false)
      $("list").endRefreshing()
      rates = resp.data.rates
      calculate()
    }
  })
}

fetch(false)